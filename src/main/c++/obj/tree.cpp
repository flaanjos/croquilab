#include "tree.h"
#include "float.h"
#include "cd.h"
#include "wd.h"
enum
{
   NUM_TRUNK_POINTS =12,
   NUM_CORWN_POINTS =194-6,
   NUM_LEAVES1_POINTS =5,
   NUM_LEAVES2_POINTS =5,
   NUM_LEAVES3_POINTS =5
};

static float trunk_coords[NUM_TRUNK_POINTS][2] = 
{
   {  -23.5f/12.0f-8/12,   0.0f/12.0f - 271.0f/12.0f  - 70.0f/12.0f},
   {   -8.5f/12.0f-8/12,   61.0f/12.0f - 271.0f/12.0f  - 35.0f/12.0f },
   {   -9.5f/12.0f,  131.0f/12.0f - 271.0f/12.0f },
   {  -18.5f/12.0f,  147.0f/12.0f - 271.0f/12.0f },
   {    3.5f/12.0f,  139.0f/12.0f - 271.0f/12.0f },
   {   16.5f/12.0f,  140.0f/12.0f - 271.0f/12.0f },
   {   32.5f/12.0f,  158.0f/12.0f - 271.0f/12.0f },
   {   19.5f/12.0f,  106.0f/12.0f - 271.0f/12.0f },
   {   15.5f/12.0f+2/12,   75.0f/12.0f - 271.0f/12.0f },
   {   13.5f/12.0f+4/12,   43.0f/12.0f - 271.0f/12.0f },
   {   12.5f/12.0f+6/12,   16.0f/12.0f - 271.0f/12.0f  - 70.0f/12.0f },
   {   17.5f/12.0f+8/12,   1.0f/12.0f - 271.0f/12.0f  - 70.0f/12.0f },
} ;

static float crown_coords[NUM_CORWN_POINTS][2] =
{
  // {  -23.5f/12.0f,    0.0f/12.0f - 271.0f/12.0f },
  // {   -8.5f/12.0f,   61.0f/12.0f - 271.0f/12.0f },
   {   -9.5f/12.0f,  131.0f/12.0f - 271.0f/12.0f },
   {  -20.5f/12.0f,  149.0f/12.0f - 271.0f/12.0f },
   {  -39.5f/12.0f,  161.0f/12.0f - 271.0f/12.0f },
   {  -58.5f/12.0f,  158.0f/12.0f - 271.0f/12.0f },
   {  -69.5f/12.0f,  150.0f/12.0f - 271.0f/12.0f },
   {  -65.5f/12.0f,  126.0f/12.0f - 271.0f/12.0f },
   {  -73.5f/12.0f,  112.0f/12.0f - 271.0f/12.0f },
   {  -88.5f/12.0f,  123.0f/12.0f - 271.0f/12.0f },
   {  -97.5f/12.0f,  127.0f/12.0f - 271.0f/12.0f },
   {  -97.5f/12.0f,  112.0f/12.0f - 271.0f/12.0f },
   { -106.5f/12.0f,  100.0f/12.0f - 271.0f/12.0f },
   { -132.5f/12.0f,  121.0f/12.0f - 271.0f/12.0f },
   { -132.5f/12.0f,  132.0f/12.0f - 271.0f/12.0f },
   { -138.5f/12.0f,  136.0f/12.0f - 271.0f/12.0f },
   { -154.5f/12.0f,  129.0f/12.0f - 271.0f/12.0f },
   { -164.5f/12.0f,  130.0f/12.0f - 271.0f/12.0f },
   { -184.5f/12.0f,  149.0f/12.0f - 271.0f/12.0f },
   { -188.5f/12.0f,  157.0f/12.0f - 271.0f/12.0f },
   { -203.5f/12.0f,  151.0f/12.0f - 271.0f/12.0f },
   { -224.5f/12.0f,  167.0f/12.0f - 271.0f/12.0f },
   { -241.5f/12.0f,  174.0f/12.0f - 271.0f/12.0f },
   { -244.5f/12.0f,  187.0f/12.0f - 271.0f/12.0f },
   { -239.5f/12.0f,  200.0f/12.0f - 271.0f/12.0f },
   { -225.5f/12.0f,  199.0f/12.0f - 271.0f/12.0f },
   { -215.5f/12.0f,  209.0f/12.0f - 271.0f/12.0f },
   { -214.5f/12.0f,  217.0f/12.0f - 271.0f/12.0f },
   { -204.5f/12.0f,  233.0f/12.0f - 271.0f/12.0f },
   { -190.5f/12.0f,  240.0f/12.0f - 271.0f/12.0f },
   { -184.5f/12.0f,  249.0f/12.0f - 271.0f/12.0f },
   { -189.5f/12.0f,  254.0f/12.0f - 271.0f/12.0f },
   { -205.5f/12.0f,  253.0f/12.0f - 271.0f/12.0f },
   { -221.5f/12.0f,  245.0f/12.0f - 271.0f/12.0f },
   { -230.5f/12.0f,  258.0f/12.0f - 271.0f/12.0f },
   { -217.5f/12.0f,  271.0f/12.0f - 271.0f/12.0f },
   { -214.5f/12.0f,  285.0f/12.0f - 271.0f/12.0f },
   { -197.5f/12.0f,  285.0f/12.0f - 271.0f/12.0f },
   { -177.5f/12.0f,  293.0f/12.0f - 271.0f/12.0f },
   { -173.5f/12.0f,  315.0f/12.0f - 271.0f/12.0f },
   { -201.5f/12.0f,  335.0f/12.0f - 271.0f/12.0f },
   { -200.5f/12.0f,  342.0f/12.0f - 271.0f/12.0f },
   { -213.5f/12.0f,  353.0f/12.0f - 271.0f/12.0f },
   { -215.5f/12.0f,  369.0f/12.0f - 271.0f/12.0f },
   { -197.5f/12.0f,  369.0f/12.0f - 271.0f/12.0f },
   { -187.5f/12.0f,  367.0f/12.0f - 271.0f/12.0f },
   { -171.5f/12.0f,  374.0f/12.0f - 271.0f/12.0f },
   { -170.5f/12.0f,  389.0f/12.0f - 271.0f/12.0f },
   { -174.5f/12.0f,  405.0f/12.0f - 271.0f/12.0f },
   { -187.5f/12.0f,  415.0f/12.0f - 271.0f/12.0f },
   { -198.5f/12.0f,  412.0f/12.0f - 271.0f/12.0f },
   { -207.5f/12.0f,  419.0f/12.0f - 271.0f/12.0f },
   { -205.5f/12.0f,  435.0f/12.0f - 271.0f/12.0f },
   { -189.5f/12.0f,  434.0f/12.0f - 271.0f/12.0f },
   { -175.5f/12.0f,  435.0f/12.0f - 271.0f/12.0f },
   { -175.5f/12.0f,  443.0f/12.0f - 271.0f/12.0f },
   { -177.5f/12.0f,  455.0f/12.0f - 271.0f/12.0f },
   { -191.5f/12.0f,  456.0f/12.0f - 271.0f/12.0f },
   { -203.5f/12.0f,  451.0f/12.0f - 271.0f/12.0f },
   { -209.5f/12.0f,  457.0f/12.0f - 271.0f/12.0f },
   { -208.5f/12.0f,  472.0f/12.0f - 271.0f/12.0f },
   { -217.5f/12.0f,  476.0f/12.0f - 271.0f/12.0f },
   { -218.5f/12.0f,  485.0f/12.0f - 271.0f/12.0f },
   { -241.5f/12.0f,  490.0f/12.0f - 271.0f/12.0f },
   { -250.5f/12.0f,  500.0f/12.0f - 271.0f/12.0f },
   { -263.5f/12.0f,  514.0f/12.0f - 271.0f/12.0f },
   { -254.5f/12.0f,  531.0f/12.0f - 271.0f/12.0f },
   { -244.5f/12.0f,  526.0f/12.0f - 271.0f/12.0f },
   { -233.5f/12.0f,  528.0f/12.0f - 271.0f/12.0f },
   { -209.5f/12.0f,  519.0f/12.0f - 271.0f/12.0f },
   { -200.5f/12.0f,  532.0f/12.0f - 271.0f/12.0f },
   { -189.5f/12.0f,  530.0f/12.0f - 271.0f/12.0f },
   { -172.5f/12.0f,  516.0f/12.0f - 271.0f/12.0f },
   { -170.5f/12.0f,  502.0f/12.0f - 271.0f/12.0f },
   { -155.5f/12.0f,  503.0f/12.0f - 271.0f/12.0f },
   { -143.5f/12.0f,  501.0f/12.0f - 271.0f/12.0f },
   { -121.5f/12.0f,  484.0f/12.0f - 271.0f/12.0f },
   { -107.5f/12.0f,  460.0f/12.0f - 271.0f/12.0f },
   {  -87.5f/12.0f,  467.0f/12.0f - 271.0f/12.0f },
   {  -72.5f/12.0f,  464.0f/12.0f - 271.0f/12.0f },
   {  -60.5f/12.0f,  476.0f/12.0f - 271.0f/12.0f },
   {  -73.5f/12.0f,  477.0f/12.0f - 271.0f/12.0f },
   {  -89.5f/12.0f,  481.0f/12.0f - 271.0f/12.0f },
   { -103.5f/12.0f,  493.0f/12.0f - 271.0f/12.0f },
   {  -93.5f/12.0f,  506.0f/12.0f - 271.0f/12.0f },
   {  -76.5f/12.0f,  504.0f/12.0f - 271.0f/12.0f },
   {  -60.5f/12.0f,  503.0f/12.0f - 271.0f/12.0f },
   {  -48.5f/12.0f,  501.0f/12.0f - 271.0f/12.0f },
   {  -41.5f/12.0f,  516.0f/12.0f - 271.0f/12.0f },
   {  -37.5f/12.0f,  523.0f/12.0f - 271.0f/12.0f },
   {  -40.5f/12.0f,  530.0f/12.0f - 271.0f/12.0f },
   {  -52.5f/12.0f,  541.0f/12.0f - 271.0f/12.0f },
   {  -36.5f/12.0f,  542.0f/12.0f - 271.0f/12.0f },
   {  -15.5f/12.0f,  541.0f/12.0f - 271.0f/12.0f },
   {   -8.5f/12.0f,  527.0f/12.0f - 271.0f/12.0f },
   {   10.5f/12.0f,  521.0f/12.0f - 271.0f/12.0f },
   {   24.5f/12.0f,  527.0f/12.0f - 271.0f/12.0f },
   {   46.5f/12.0f,  527.0f/12.0f - 271.0f/12.0f },
   {   42.5f/12.0f,  520.0f/12.0f - 271.0f/12.0f },
   {   27.5f/12.0f,  508.0f/12.0f - 271.0f/12.0f },
   {   21.5f/12.0f,  492.0f/12.0f - 271.0f/12.0f },
   {   42.5f/12.0f,  495.0f/12.0f - 271.0f/12.0f },
   {   62.5f/12.0f,  500.0f/12.0f - 271.0f/12.0f },
   {   71.5f/12.0f,  505.0f/12.0f - 271.0f/12.0f },
   {   80.5f/12.0f,  504.0f/12.0f - 271.0f/12.0f },
   {   82.5f/12.0f,  493.0f/12.0f - 271.0f/12.0f },
   {  109.5f/12.0f,  499.0f/12.0f - 271.0f/12.0f },
   {  127.5f/12.0f,  503.0f/12.0f - 271.0f/12.0f },
   {  139.5f/12.0f,  504.0f/12.0f - 271.0f/12.0f },
   {  159.5f/12.0f,  512.0f/12.0f - 271.0f/12.0f },
   {  178.5f/12.0f,  517.0f/12.0f - 271.0f/12.0f },
   {  189.5f/12.0f,  515.0f/12.0f - 271.0f/12.0f },
   {  195.5f/12.0f,  506.0f/12.0f - 271.0f/12.0f },
   {  189.5f/12.0f,  496.0f/12.0f - 271.0f/12.0f },
   {  167.5f/12.0f,  496.0f/12.0f - 271.0f/12.0f },
   {  142.5f/12.0f,  481.0f/12.0f - 271.0f/12.0f },
   {  125.5f/12.0f,  473.0f/12.0f - 271.0f/12.0f },
   {  112.5f/12.0f,  470.0f/12.0f - 271.0f/12.0f },
   {  131.5f/12.0f,  464.0f/12.0f - 271.0f/12.0f },
   {  143.5f/12.0f,  457.0f/12.0f - 271.0f/12.0f },
   {  156.5f/12.0f,  450.0f/12.0f - 271.0f/12.0f },
   {  177.5f/12.0f,  451.0f/12.0f - 271.0f/12.0f },
   {  175.5f/12.0f,  439.0f/12.0f - 271.0f/12.0f },
   {  162.5f/12.0f,  434.0f/12.0f - 271.0f/12.0f },
   {  153.5f/12.0f,  428.0f/12.0f - 271.0f/12.0f },
   {  154.5f/12.0f,  415.0f/12.0f - 271.0f/12.0f },
   {  147.5f/12.0f,  409.0f/12.0f - 271.0f/12.0f },
   {  137.5f/12.0f,  404.0f/12.0f - 271.0f/12.0f },
   {  133.5f/12.0f,  390.0f/12.0f - 271.0f/12.0f },
   {  151.5f/12.0f,  383.0f/12.0f - 271.0f/12.0f },
   {  173.5f/12.0f,  371.0f/12.0f - 271.0f/12.0f },
   {  191.5f/12.0f,  373.0f/12.0f - 271.0f/12.0f },
   {  218.5f/12.0f,  357.0f/12.0f - 271.0f/12.0f },
   {  238.5f/12.0f,  343.0f/12.0f - 271.0f/12.0f },
   {  251.5f/12.0f,  338.0f/12.0f - 271.0f/12.0f },
   {  258.5f/12.0f,  327.0f/12.0f - 271.0f/12.0f },
   {  249.5f/12.0f,  304.0f/12.0f - 271.0f/12.0f },
   {  230.5f/12.0f,  304.0f/12.0f - 271.0f/12.0f },
   {  251.5f/12.0f,  294.0f/12.0f - 271.0f/12.0f },
   {  260.5f/12.0f,  277.0f/12.0f - 271.0f/12.0f },
   {  248.5f/12.0f,  275.0f/12.0f - 271.0f/12.0f },
   {  258.5f/12.0f,  267.0f/12.0f - 271.0f/12.0f },
   {  263.5f/12.0f,  258.0f/12.0f - 271.0f/12.0f },
   {  246.5f/12.0f,  242.0f/12.0f - 271.0f/12.0f },
   {  228.5f/12.0f,  259.0f/12.0f - 271.0f/12.0f },
   {  219.5f/12.0f,  252.0f/12.0f - 271.0f/12.0f },
   {  205.5f/12.0f,  254.0f/12.0f - 271.0f/12.0f },
   {  197.5f/12.0f,  262.0f/12.0f - 271.0f/12.0f },
   {  177.5f/12.0f,  260.0f/12.0f - 271.0f/12.0f },
   {  175.5f/12.0f,  251.0f/12.0f - 271.0f/12.0f },
   {  169.5f/12.0f,  253.0f/12.0f - 271.0f/12.0f },
   {  163.5f/12.0f,  252.0f/12.0f - 271.0f/12.0f },
   {  169.5f/12.0f,  237.0f/12.0f - 271.0f/12.0f },
   {  174.5f/12.0f,  225.0f/12.0f - 271.0f/12.0f },
   {  190.5f/12.0f,  222.0f/12.0f - 271.0f/12.0f },
   {  205.5f/12.0f,  207.0f/12.0f - 271.0f/12.0f },
   {  201.5f/12.0f,  193.0f/12.0f - 271.0f/12.0f },
   {  185.5f/12.0f,  189.0f/12.0f - 271.0f/12.0f },
   {  176.5f/12.0f,  195.0f/12.0f - 271.0f/12.0f },
   {  171.5f/12.0f,  186.0f/12.0f - 271.0f/12.0f },
   {  168.5f/12.0f,  177.0f/12.0f - 271.0f/12.0f },
   {  160.5f/12.0f,  184.0f/12.0f - 271.0f/12.0f },
   {  157.5f/12.0f,  205.0f/12.0f - 271.0f/12.0f },
   {  147.5f/12.0f,  222.0f/12.0f - 271.0f/12.0f },
   {  132.5f/12.0f,  221.0f/12.0f - 271.0f/12.0f },
   {  126.5f/12.0f,  224.0f/12.0f - 271.0f/12.0f },
   {  119.5f/12.0f,  220.0f/12.0f - 271.0f/12.0f },
   {  115.5f/12.0f,  223.0f/12.0f - 271.0f/12.0f },
   {  102.5f/12.0f,  218.0f/12.0f - 271.0f/12.0f },
   {  104.5f/12.0f,  203.0f/12.0f - 271.0f/12.0f },
   {  107.5f/12.0f,  195.0f/12.0f - 271.0f/12.0f },
   {   98.5f/12.0f,  189.0f/12.0f - 271.0f/12.0f },
   {   95.5f/12.0f,  184.0f/12.0f - 271.0f/12.0f },
   {  108.5f/12.0f,  162.0f/12.0f - 271.0f/12.0f },
   {  127.5f/12.0f,  150.0f/12.0f - 271.0f/12.0f },
   {  140.5f/12.0f,  148.0f/12.0f - 271.0f/12.0f },
   {  133.5f/12.0f,  139.0f/12.0f - 271.0f/12.0f },
   {  119.5f/12.0f,  136.0f/12.0f - 271.0f/12.0f },
   {  110.5f/12.0f,  123.0f/12.0f - 271.0f/12.0f },
   {  115.5f/12.0f,  103.0f/12.0f - 271.0f/12.0f },
   {  114.5f/12.0f,   90.0f/12.0f - 271.0f/12.0f },
   {  105.5f/12.0f,   94.0f/12.0f - 271.0f/12.0f },
   {   97.5f/12.0f,  123.0f/12.0f - 271.0f/12.0f },
   {   87.5f/12.0f,  142.0f/12.0f - 271.0f/12.0f },
   {   72.5f/12.0f,  159.0f/12.0f - 271.0f/12.0f },
   {   63.5f/12.0f,  157.0f/12.0f - 271.0f/12.0f },
   {   55.5f/12.0f,  147.0f/12.0f - 271.0f/12.0f },
   {   46.5f/12.0f,  160.0f/12.0f - 271.0f/12.0f },
   {   32.5f/12.0f,  158.0f/12.0f - 271.0f/12.0f },
   {   19.5f/12.0f,  106.0f/12.0f - 271.0f/12.0f },
  // {   15.5f/12.0f,   75.0f/12.0f - 271.0f/12.0f },
 //  {   13.5f/12.0f,   43.0f/12.0f - 271.0f/12.0f },
 //  {   12.5f/12.0f,   16.0f/12.0f - 271.0f/12.0f },
//   {   17.5f/12.0f,    1.0f/12.0f - 271.0f/12.0f },
} ;

static float leaves_1_coords[NUM_LEAVES1_POINTS][2] = 
{
   { -136.5f/12.0f,  389.0f/12.0f - 271.0f/12.0f },
   { -108.5f/12.0f,  373.0f/12.0f - 271.0f/12.0f },
   { -114.5f/12.0f,  338.0f/12.0f - 271.0f/12.0f },
   {  -89.5f/12.0f,  320.0f/12.0f - 271.0f/12.0f },
   {  -68.5f/12.0f,  321.0f/12.0f - 271.0f/12.0f },
};
static float leaves_2_coords[NUM_LEAVES2_POINTS][2] =
{
   { -155.5f/12.0f,  229.0f/12.0f - 271.0f/12.0f },
   { -130.5f/12.0f,  224.0f/12.0f - 271.0f/12.0f },
   { -130.5f/12.0f,  202.0f/12.0f - 271.0f/12.0f },
   { -108.5f/12.0f,  202.0f/12.0f - 271.0f/12.0f },
   { -102.5f/12.0f,  187.0f/12.0f - 271.0f/12.0f },

};
static float leaves_3_coords[NUM_LEAVES3_POINTS][2] = 
{
   {   90.5f/12.0f,  249.0f/12.0f - 271.0f/12.0f },
   {   91.5f/12.0f,  265.0f/12.0f - 271.0f/12.0f },
   {  113.5f/12.0f,  265.0f/12.0f - 271.0f/12.0f },
   {  126.5f/12.0f,  284.0f/12.0f - 271.0f/12.0f },
   {  146.5f/12.0f,  274.0f/12.0f - 271.0f/12.0f },
};



Tree::Tree()  
{
   int i =  0 ;

   for( i=0 ; i<NUM_TRUNK_POINTS ; i++ )
   {
      _trunk.addPoint( i, Point2d( trunk_coords[i][0], trunk_coords[i][1] ) );
   }
   for( i=0 ; i<NUM_CORWN_POINTS ; i++ )
   {
      _crown.addPoint( i, Point2d( crown_coords[i][0], crown_coords[i][1] ) );
   }
   _crown.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES1_POINTS ; i++ )
   {
      _leaves_1.addPoint( i, Point2d( leaves_1_coords[i][0], leaves_1_coords[i][1] ) );
   }
   _leaves_1.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES2_POINTS ; i++ )
   {
      _leaves_2.addPoint( i, Point2d( leaves_2_coords[i][0], leaves_2_coords[i][1] ) );
   }
   _leaves_2.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES3_POINTS ; i++ )
   {
      _leaves_3.addPoint( i, Point2d( leaves_3_coords[i][0], leaves_3_coords[i][1] ) );
   }
   _leaves_3.autoBezier() ;
}

Tree::~Tree()
{
};

const Point2d & Tree::scale( ) const
{
   return _scale ;
} ;

void Tree::scale( const Point2d & s ) 
{
   edit( s, _position ) ;
};

const Point2d & Tree::position( ) const
{
   return _position ;
} ;

void Tree::position( const Point2d & p ) 
{
   edit( _scale, p ) ;
};

void Tree::edit( const Point2d & s, const Point2d & p ) 
{
   _position = p ;
   _scale = s ;
   _scale._x = -_scale._x;

   int i = 0 ;
   for( i=0 ; i<NUM_TRUNK_POINTS ; i++ )
   {
      _trunk.editPoint( i, Point2d( trunk_coords[i][0]*s._x+p._x, trunk_coords[i][1]*s._y+p._y ) );
   }
   for( i=0 ; i<NUM_CORWN_POINTS ; i++ )
   {
      _crown.editPoint( i, Point2d( crown_coords[i][0]*s._x+p._x, crown_coords[i][1]*s._y+p._y ) );
   }
   _crown.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES1_POINTS ; i++ )
   {
      _leaves_1.editPoint( i, Point2d( leaves_1_coords[i][0]*s._x+p._x, leaves_1_coords[i][1]*s._y+p._y ) );
   }
   _leaves_1.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES2_POINTS ; i++ )
   {
      _leaves_2.editPoint( i, Point2d( leaves_2_coords[i][0]*s._x+p._x, leaves_2_coords[i][1]*s._y+p._y ) );
   }
   _leaves_2.autoBezier() ;

   for( i=0 ; i<NUM_LEAVES3_POINTS ; i++ )
   {
      _leaves_3.editPoint( i, Point2d( leaves_3_coords[i][0]*s._x+p._x, leaves_3_coords[i][1]*s._y+p._y ) );
   }
   _leaves_3.autoBezier() ;

   _scale._x = -_scale._x;
};

void Tree::draw( const Point2d & s, const Point2d & p )const 
{
   _crown.draw( s, p ) ;
   _leaves_1.draw( s, p ) ;
   _leaves_2.draw( s, p ) ;
   _leaves_3.draw( s, p ) ;
   cdInteriorStyle( CD_SOLID ) ; 
   _trunk.draw( s, p ) ;
} ;

void Tree::drawSelectable()
{
   _crown.draw( Bezier::FILL ) ;
   _crown.draw() ;
   _leaves_1.draw() ;
   _leaves_2.draw() ;
   _leaves_3.draw() ;
   cdInteriorStyle( CD_SOLID ) ; 
   _trunk.draw( ) ;
} ;
void Tree::draw( ) const
{
   cdForeground( CD_WHITE ) ;
   _crown.draw( Bezier::FILL ) ;

   cdForeground( color() ) ;
   _crown.draw() ;
   _leaves_1.draw() ;
   _leaves_2.draw() ;
   _leaves_3.draw() ;
   cdInteriorStyle( CD_SOLID ) ; 
   _trunk.draw( ) ;

} ;

void Tree::boundingBox( Point2d& min, Point2d& max ) const 
{
   min._x = min._y = DBL_MAX;
   max._x = max._y = -DBL_MAX;

   for( unsigned int i = 0 ; i< _crown.numPoints() ; i++ )
   {
      updateBoundingBox( min, max, _crown.pointVal(i) );
   }
   for( unsigned int i = 0 ; i< _trunk.numPoints() ; i++ )
   {
      updateBoundingBox( min, max, _trunk.pointVal(i) );
   }
};

Object *Tree::copy()
{
   return new Tree( *this ) ;
}


/*
{ 31.37500, 1.50000 },
{ 32.15605, 3.84856 },
{ 33.25000, 9.12500 },
{ 33.58355, 13.50576 },
{ 33.12500, 17.87500 },
{ 32.72030, 19.14028 },
{ 31.75000, 20.12500 },
{ 30.70259, 21.12604 },
{ 29.37500, 21.62500 },
{ 28.17208, 21.69660 },
{ 27.00000, 21.25000 },
{ 26.08132, 20.95168 },
{ 25.62500, 20.25000 },
{ 25.81284, 18.76004 },
{ 26.12500, 17.25000 },
{ 25.96018, 16.04804 },
{ 25.12500, 15.50000 },
{ 24.12490, 15.90005 },
{ 23.25000, 16.87500 },
{ 22.63793, 17.42599 },
{ 22.12500, 17.37500 },
{ 22.01355, 16.49893 },
{ 22.12500, 15.50000 },
{ 21.79181, 14.32893 },
{ 21.00000, 14.00000 },
{ 19.11032, 14.89963 },
{ 17.75000, 16.62500 },
{ 17.68317, 17.27322 },
{ 17.75000, 18.00000 },
{ 17.47969, 18.42976 },
{ 17.00000, 18.50000 },
{ 15.99327, 18.09924 },
{ 15.00000, 17.62500 },
{ 14.34147, 17.50388 },
{ 13.75000, 17.75000 },
{ 12.39158, 18.81290 },
{ 11.25000, 20.12500 },
{ 11.06921, 20.75974 },
{ 10.75000, 21.12500 },
{ 9.80077, 20.68830 },
{ 8.87500, 20.37500 },
{ 7.49566, 21.22021 },
{ 6.25000, 22.37500 },
{ 5.12356, 22.73093 },
{ 4.12500, 23.25000 },
{ 3.69241, 23.97183 },
{ 3.75000, 24.87500 },
{ 3.81153, 25.83867 },
{ 4.37500, 26.50000 },
{ 5.22012, 26.49766 },
{ 6.12500, 26.37500 },
{ 6.88751, 26.83356 },
{ 7.37500, 27.62500 },
{ 7.45730, 28.11446 },
{ 7.50000, 28.62500 },
{ 7.98998, 29.72103 },
{ 8.75000, 30.62500 },
{ 9.60340, 31.08716 },
{ 10.50000, 31.50000 },
{ 11.05490, 31.96800 },
{ 11.25000, 32.62500 },
{ 11.11211, 33.07180 },
{ 10.62500, 33.25000 },
{ 9.61760, 33.35953 },
{ 8.62500, 33.12500 },
{ 7.63252, 32.42926 },
{ 6.62500, 32.12500 },
{ 5.64277, 32.64391 },
{ 5.50000, 33.75000 },
{ 6.15835, 34.61769 },
{ 7.12500, 35.37500 },
{ 7.20866, 36.34625 },
{ 7.50000, 37.12500 },
{ 8.49947, 37.26929 },
{ 9.62500, 37.12500 },
{ 11.05307, 37.33746 },
{ 12.12500, 38.12500 },
{ 12.96241, 39.45421 },
{ 12.62500, 40.87500 },
{ 11.04514, 42.25495 },
{ 9.12500, 43.37500 },
{ 9.16224, 43.79179 },
{ 9.25000, 44.25000 },
{ 8.40994, 44.92069 },
{ 7.62500, 45.62500 },
{ 7.04924, 46.68813 },
{ 7.37500, 47.62500 },
{ 8.37751, 47.95337 },
{ 9.62500, 47.62500 },
{ 10.25369, 47.43783 },
{ 10.87500, 47.37500 },
{ 12.02668, 47.56591 },
{ 12.87500, 48.25000 },
{ 13.18688, 49.11560 },
{ 13.00000, 50.12500 },
{ 12.92430, 51.18622 },
{ 12.50000, 52.12500 },
{ 11.84616, 52.96410 },
{ 10.87500, 53.37500 },
{ 10.19300, 53.20992 },
{ 9.50000, 53.00000 },
{ 8.75327, 53.23426 },
{ 8.37500, 53.87500 },
{ 8.09964, 54.99461 },
{ 8.62500, 55.87500 },
{ 9.53791, 56.05304 },
{ 10.62500, 55.75000 },
{ 11.55225, 55.63461 },
{ 12.37500, 55.87500 },
{ 12.55138, 56.28982 },
{ 12.37500, 56.87500 },
{ 12.44292, 57.72891 },
{ 12.12500, 58.37500 },
{ 11.31982, 58.69496 },
{ 10.37500, 58.50000 },
{ 9.62807, 58.12427 },
{ 8.87500, 57.87500 },
{ 8.34750, 58.06757 },
{ 8.12500, 58.62500 },
{ 8.24262, 59.58053 },
{ 8.25000, 60.50000 },
{ 7.73867, 60.77978 },
{ 7.12500, 61.00000 },
{ 7.11642, 61.62378 },
{ 7.00000, 62.12500 },
{ 5.58549, 62.48132 },
{ 4.12500, 62.75000 },
{ 3.49006, 63.27639 },
{ 3.00000, 64.00000 },
{ 1.94223, 64.76099 },
{ 1.37500, 65.75000 },
{ 1.49864, 67.01888 },
{ 2.50000, 67.87500 },
{ 3.08715, 67.73949 },
{ 3.75000, 67.25000 },
{ 4.43995, 67.38933 },
{ 5.12500, 67.50000 },
{ 6.61770, 66.74739 },
{ 8.12500, 66.37500 },
{ 8.73068, 67.05350 },
{ 9.25000, 68.00000 },
{ 9.93959, 68.13129 },
{ 10.62500, 67.75000 },
{ 11.84583, 67.04602 },
{ 12.75000, 66.00000 },
{ 12.79782, 65.05207 },
{ 13.00000, 64.25000 },
{ 13.86528, 64.11151 },
{ 14.87500, 64.37500 },
{ 15.66103, 64.37854 },
{ 16.37500, 64.12500 },
{ 17.88889, 63.23428 },
{ 19.12500, 62.00000 },
{ 19.84721, 60.30189 },
{ 20.87500, 59.00000 },
{ 22.07578, 59.15901 },
{ 23.37500, 59.87500 },
{ 24.32858, 59.61483 },
{ 25.25000, 59.50000 },
{ 26.40784, 59.97920 },
{ 26.75000, 61.00000 },
{ 26.21521, 61.31527 },
{ 25.12500, 61.12500 },
{ 24.08514, 61.25877 },
{ 23.12500, 61.62500 },
{ 21.93695, 62.15163 },
{ 21.37500, 63.12500 },
{ 21.58327, 64.17204 },
{ 22.62500, 64.75000 },
{ 23.65950, 64.81268 },
{ 24.75000, 64.50000 },
{ 25.75060, 64.44351 },
{ 26.75000, 64.37500 },
{ 27.54819, 64.05862 },
{ 28.25000, 64.12500 },
{ 28.83418, 64.93457 },
{ 29.12500, 66.00000 },
{ 29.44604, 66.41803 },
{ 29.62500, 66.87500 },
{ 29.56449, 67.35342 },
{ 29.25000, 67.75000 },
{ 28.13510, 68.36864 },
{ 27.75000, 69.12500 },
{ 28.49309, 69.54395 },
{ 29.75000, 69.25000 },
{ 31.12090, 69.42018 },
{ 32.37500, 69.12500 },
{ 32.84510, 68.30044 },
{ 33.25000, 67.37500 },
{ 34.34066, 66.71527 },
{ 35.62500, 66.62500 },
{ 36.50486, 66.94131 },
{ 37.37500, 67.37500 },
{ 38.77805, 67.64666 },
{ 40.12500, 67.37500 },
{ 40.18472, 67.00262 },
{ 39.62500, 66.50000 },
{ 38.63928, 65.79182 },
{ 37.75000, 65.00000 },
{ 36.83205, 63.94190 },
{ 37.00000, 63.00000 },
{ 38.20023, 62.76666 },
{ 39.62500, 63.37500 },
{ 40.89245, 63.62252 },
{ 42.12500, 64.00000 },
{ 42.68007, 64.33882 },
{ 43.25000, 64.62500 },
{ 43.87627, 64.76499 },
{ 44.37500, 64.50000 },
{ 44.41884, 63.66386 },
{ 44.62500, 63.12500 },
{ 46.31851, 63.24923 },
{ 48.00000, 63.87500 },
{ 49.12059, 64.14771 },
{ 50.25000, 64.37500 },
{ 51.00670, 64.40749 },
{ 51.75000, 64.50000 },
{ 53.00705, 64.97704 },
{ 54.25000, 65.50000 },
{ 55.41616, 65.91229 },
{ 56.62500, 66.12500 },
{ 57.35324, 66.16843 },
{ 58.00000, 65.87500 },
{ 58.58784, 65.42829 },
{ 58.75000, 64.75000 },
{ 58.63240, 63.94360 },
{ 58.00000, 63.50000 },
{ 56.63063, 63.48335 },
{ 55.25000, 63.50000 },
{ 53.63587, 62.68295 },
{ 52.12500, 61.62500 },
{ 51.08971, 61.06509 },
{ 50.00000, 60.62500 },
{ 48.72047, 60.59003 },
{ 48.37500, 60.25000 },
{ 49.39088, 59.66704 },
{ 50.75000, 59.50000 },
{ 51.51618, 59.09567 },
{ 52.25000, 58.62500 },
{ 53.02365, 58.07856 },
{ 53.87500, 57.75000 },
{ 55.24632, 57.97375 },
{ 56.50000, 57.87500 },
{ 56.81041, 57.19594 },
{ 56.25000, 56.37500 },
{ 55.51350, 55.96371 },
{ 54.62500, 55.75000 },
{ 53.93413, 55.49527 },
{ 53.50000, 55.00000 },
{ 53.53594, 54.19726 },
{ 53.62500, 53.37500 },
{ 53.30385, 52.91133 },
{ 52.75000, 52.62500 },
{ 52.06044, 52.38110 },
{ 51.50000, 52.00000 },
{ 50.85828, 51.13421 },
{ 51.00000, 50.25000 },
{ 51.96722, 49.63008 },
{ 53.25000, 49.37500 },
{ 54.58573, 48.51545 },
{ 56.00000, 47.87500 },
{ 57.13149, 48.02315 },
{ 58.25000, 48.12500 },
{ 60.01984, 47.30225 },
{ 61.62500, 46.12500 },
{ 62.86144, 45.22765 },
{ 64.12500, 44.37500 },
{ 64.96549, 44.10355 },
{ 65.75000, 43.75000 },
{ 66.44407, 43.17666 },
{ 66.62500, 42.37500 },
{ 66.47581, 40.72706 },
{ 65.50000, 39.50000 },
{ 63.88107, 39.65401 },
{ 63.12500, 39.50000 },
{ 64.13921, 38.70512 },
{ 65.75000, 38.25000 },
{ 66.71791, 37.33122 },
{ 66.87500, 36.12500 },
{ 66.13645, 35.99795 },
{ 65.37500, 35.87500 },
{ 65.74255, 35.30574 },
{ 66.62500, 34.87500 },
{ 67.20157, 34.34910 },
{ 67.25000, 33.75000 },
{ 66.49766, 32.24110 },
{ 65.12500, 31.75000 },
{ 63.96411, 32.62753 },
{ 62.87500, 33.87500 },
{ 62.32304, 33.58708 },
{ 61.75000, 33.00000 },
{ 60.85286, 32.91743 },
{ 60.00000, 33.25000 },
{ 59.51788, 33.80416 },
{ 59.00000, 34.25000 },
{ 57.71072, 34.43438 },
{ 56.50000, 34.00000 },
{ 56.34435, 33.48315 },
{ 56.25000, 32.87500 },
{ 55.91116, 32.89008 },
{ 55.50000, 33.12500 },
{ 54.98293, 33.21690 },
{ 54.75000, 33.00000 },
{ 54.98214, 32.03452 },
{ 55.50000, 31.12500 },
{ 55.67952, 30.26993 },
{ 56.12500, 29.62500 },
{ 57.10552, 29.40732 },
{ 58.12500, 29.25000 },
{ 59.31613, 28.52771 },
{ 60.00000, 27.37500 },
{ 60.12468, 26.40921 },
{ 59.50000, 25.62500 },
{ 58.59800, 25.08559 },
{ 57.50000, 25.12500 },
{ 56.93268, 25.57334 },
{ 56.37500, 25.87500 },
{ 55.92456, 25.48245 },
{ 55.75000, 24.75000 },
{ 55.69096, 24.02409 },
{ 55.37500, 23.62500 },
{ 54.72097, 23.78604 },
{ 54.37500, 24.50000 },
{ 54.16664, 25.80484 },
{ 54.00000, 27.12500 },
{ 53.61472, 28.37569 },
{ 52.75000, 29.25000 },
{ 51.86649, 29.34403 },
{ 50.87500, 29.12500 },
{ 50.50024, 29.33946 },
{ 50.12500, 29.50000 },
{ 49.68728, 29.25261 },
{ 49.25000, 29.00000 },
{ 48.99968, 29.19058 },
{ 48.75000, 29.37500 },
{ 47.77061, 29.31040 },
{ 47.12500, 28.75000 },
{ 47.00373, 27.84831 },
{ 47.37500, 26.87500 },
{ 47.68392, 26.36338 },
{ 47.75000, 25.87500 },
{ 47.27451, 25.43829 },
{ 46.62500, 25.12500 },
{ 46.28929, 24.84831 },
{ 46.25000, 24.50000 },
{ 46.86003, 22.99950 },
{ 47.87500, 21.75000 },
{ 48.94094, 20.82757 },
{ 50.25000, 20.25000 },
{ 51.19731, 20.27207 },
{ 51.87500, 20.00000 },
{ 51.79748, 19.33548 },
{ 51.00000, 18.87500 },
{ 50.10912, 18.71264 },
{ 49.25000, 18.50000 },
{ 48.42788, 17.84376 },
{ 48.12500, 16.87500 },
{ 48.32122, 15.62500 },
{ 48.75000, 14.37500 },
{ 48.95141, 13.46356 },
{ 48.62500, 12.75000 },
{ 47.99664, 12.64038 },
{ 47.50000, 13.25000 },
{ 46.92467, 15.02911 },
{ 46.50000, 16.87500 },
{ 45.98534, 18.12035 },
{ 45.25000, 19.25000 },
{ 44.46001, 20.46732 },
{ 43.37500, 21.37500 },
{ 42.80579, 21.48914 },
{ 42.25000, 21.12500 },
{ 41.80037, 20.27475 },
{ 41.25000, 19.87500 },
{ 40.65687, 20.59201 },
{ 40.12500, 21.50000 },
{ 39.09921, 21.81447 },
{ 38.37500, 21.25000 },
{ 37.25276, 18.10708 },
{ 36.75000, 14.75000 },
{ 36.42246, 12.82410 },
{ 36.25000, 10.87500 },
{ 36.09192, 8.87742 },
{ 36.00000, 6.87500 },
{ 35.84531, 5.18546 },
Press any key to continue
*/

